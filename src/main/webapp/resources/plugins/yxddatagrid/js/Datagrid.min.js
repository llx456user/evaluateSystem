/**
 * Datagrid jQuery plugin.
 * version 1.0.0 (Jul, 2017)
 * Copyright (c) 2017 yxd
 */
(function(c){var b;var a={init:function(e){var d=this;return this.each(function(){var h=c(this);var f=h.data("Datagrid.options");if(typeof(f)=="undefined"){var g={};f=c.extend({},g,e);h.data("Datagrid.options",f)}else{f=c.extend({},f,e)}b=f})},load:function(d){return this.each(function(){var i=c(this);var j=d.queryParams||{};if(!d.queryParams){d.queryParams=j}if(!d.other.currentPage){d.other.currentPage=1}if(!d.other.pageSize){d.other.pageSize=10}j.page=d.other.currentPage||1;j.rows=d.other.pageSize||10;var h={checkable:false,sortable:false,colHover:true,hoverClass:"hover",minFixedLeftWidth:300};var e=c.extend({},h,d.tables);d.tables=e;i.Datagrid("init",d);var f=true;if(d.other.openProgress!=undefined){if(!d.other.openProgress){f=false}}var g;if(f){g=openProgressExt("加载中...")}c.ajax({url:d.url,data:j,type:"post",cache:false,success:function(k){if(f){closeProgressExt(g)}d.data=k;i.Datagrid("renderTable",d)}})})},renderTable:function(e){var h=e.data;var j=c(this);j.datatable(e.tables).off("render.zui.datatable").on("render.zui.datatable",function(k){var l=j.data("Datagrid.rowDatas");if(l){c.each(l,function(m,n){if(e.rowStyler&&e.rowStyler!="null"){if(e.rowStyler&&typeof(e.rowStyler)==="function"){c.each(h.rows,function(o,q){var p=e.rowStyler(o,q);c(j.context).next().find("table tbody tr").filter('[data-id="'+n.id+'"]').attr("style",p)})}}})}if(e.onLoadSuccess&&typeof(e.onLoadSuccess)==="function"){e.onLoadSuccess(h)}});var i=e.other.data.cols;var g=[];var d=0;c.each(i,function(l,k){if(k.hidden!=undefined){i[l].colClass=k.hidden||k.hidden=="true"?"myColW-hidden":"myColW-break"}if(k.title){i[l].text=k.title}if(!i[l].colClass){i[l].colClass="myColW-break"}});c.each(h.rows,function(l,p){var n=[];var k=false;c.each(i,function(o,s){if(s.formatter&&s.formatter!="null"){if(typeof s.formatter==="function"){var q=s.formatter(p[s.field]==null?"":p[s.field],p,l);n.push(q)}}else{if(s.field=="#"){k=true}else{n.push(p[s.field]==null?"":p[s.field])}}});if(k){n.unshift(l+1)}var m={id:e.other.currentPage+"_"+l,data:n};g.push(m);j.removeData("Datagrid.rowDatas");j.data("Datagrid.rowDatas",g)});j.datatable("load",{cols:i,rows:g});var f=e.other.currentPage;c(".yxdPageCode").createPage({pageCount:parseInt(h.total<e.other.pageSize?1:(parseInt(h.total)%parseInt(e.other.pageSize)==0?(parseInt(h.total)/parseInt(e.other.pageSize)):(parseInt(h.total)/parseInt(e.other.pageSize)+1))),current:parseInt(f),backFn:function(k){e.other.currentPage=k;j.Datagrid("load",e)}})},options:function(){return c(this).data("Datagrid.options")||b},reload:function(){var d=c(this).data("Datagrid.options")||b;if(d==null){throw new Error("settings is null")}else{c(this).Datagrid("load",d)}},getChecked:function(){var h=c(this);var d=c(this).data("Datagrid.options")||b;var g=d.other.data.cols;var f=h.data("Datagrid.rowDatas");var i=[];var e=[];if(!h.data("zui.datatable").checks){console.log("selected is null");return e}c.each(f,function(j,k){c.each(h.data("zui.datatable").checks.checks,function(l,m){if(m==k.id){i.push(k)}})});c.each(i,function(j,k){var l=new Object();c.each(g,function(n,m){if(k.data[n]&&typeof(k.data[n])==="object"){l[m.field]=k.data[n].text}else{if(typeof(k.data[n])=="string"){l[m.field]=k.data[n]}else{l[m.field]=String(k.data[n])}}});e.push(l)});return e},getRows:function(){var h=c(this);var d=c(this).data("Datagrid.options")||b;var g=d.other.data.cols;var f=h.data("Datagrid.rowDatas");var e=[];c.each(f,function(j,k){var l=new Object();c.each(g,function(m,i){if(k.data[m]&&typeof(k.data[m])==="object"){l[i.field]=k.data[m].text}else{if(typeof(k.data[m])=="string"){l[i.field]=k.data[m]}else{l[i.field]=String(k.data[m])}}});e.push(l)});return e},selectRow:function(d){var e=c(this);return this.each(function(){c(c(this).context).next().find("table tbody tr").eq(d).find(".check-btn").click()})},beginEdit:function(d){var e=c(this);return this.each(function(){var h=c(c(this).context).next().find(".table tbody tr").filter('[data-index="'+d+'"]');var g=e.data("Datagrid.options")||b;var i=g.other.data.cols;var f=[];c.each(i,function(n,l){if(l.editor&&typeof(l.editor)==="object"){var m=l.editor;var p=h.find("td").filter('[data-index="'+n+'"]');var j=p.html();var o=l.editor.options&&l.editor.options.required?l.editor.options.required:false;var k=o?"dataRequired":"";var q="";if(m.type=="datetimebox"){q='<input type="text" class="'+k+" form-control form-datetime-empty_"+n+'" id="'+l.field+"_"+d+"_"+n+'" value="'+j+'"/>'}else{if(m.type=="validatebox"){q='<input type="text" class="'+k+' form-control" id="'+l.field+"_"+d+"_"+n+'" value="'+j+'"/>'}else{q='<input type="text" class="'+k+' form-control" id="'+l.field+"_"+d+"_"+n+'" value="'+j+'"/>'}}p.html(q);f.push("form-datetime-empty_"+n)}});c.each(f,function(j,k){c("."+k).datetimepicker({language:"zh-CN",todayBtn:1,autoclose:1,todayHighlight:1,showMeridian:true,format:"yyyy-mm-dd hh:ii:ss"})});e.data("Datagrid.valid",false)})},endEdit:function(d){var e=c(this);return this.each(function(){var i=e.data("Datagrid.rowDatas");
var h=c(c(this).context).next().find(".table tbody tr").filter('[data-index="'+d+'"]');var g=e.data("Datagrid.options")||b;var j=g.other.data.cols;var f=[];var k=[];c.each(j,function(m,l){if(l.editor&&typeof(l.editor)==="object"){if(l.editor.options&&typeof(l.editor.options)==="object"){var n=l.editor.options.required;if(n!=undefined&&n==true){if(c("#"+l.field+"_"+d+"_"+m).val()==""){k.push(l.field+"_"+d+"_"+m)}}}}});if(k.length>0){c.each(k,function(l,m){c("#"+m).attr("data-toggle","tooltip")});c('[data-toggle="tooltip"]').tooltip({tipClass:"tooltip-danger",dataPlacement:"auto",title:"该项为必填项!"});c('[data-toggle="tooltip"]').tooltip("show");return}c.each(j,function(n,l){if(l.editor&&typeof(l.editor)==="object"){var m=l.editor;var o=h.find("td").filter('[data-index="'+n+'"]');var p;if(m.type=="datetimebox"||m.type=="validatebox"){p=o.find("input").val()}else{p=o.find("input").val()}o.html(p);i[d].data[n]=p}});e.data("Datagrid.rowDatas",i)})},validate:function(){var h=c(this);var g=this.next().find(".table tbody tr td .dataRequired");var d=g.length;var e;if(d>0){var f=false;c.each(g,function(){var i=c(this).val();if(i==null||i==""){e=c(this);f=true;return false}});if(f){e.attr("data-toggle","tooltip");e.focus();e.tooltip({tipClass:"tooltip-danger",dataPlacement:"auto",title:"该项为必填项!"});e.tooltip("show");return false}}return true}};c.fn.Datagrid=function(){var d=arguments[0];if(a[d]){d=a[d];arguments=Array.prototype.slice.call(arguments,1)}else{if(typeof(d)=="object"||!d){d=a.init}else{c.error("Method "+d+" does not exist on jQuery.Datagrid");return this}}return d.call(this,arguments[0])}})(jQuery);if(window.sessionStorage&&!window.sessionStorage.myDog){console.log("          .----.  \n"+"       _.’ __    `.   \n"+"    .--(#)(##)---/#  \n"+"  .’ @          /###  \n"+"  :         ,   #####  \n"+"  `-..__.-’ _.-###/    \n"+'         `;_:    `"’  \n'+'       .’"""""`.   \n'+"      /,  yxd   ,  \n"+"     //    make!  \\ \n"+"     `-._______.-’  \n"+"     ___`. | .’___   \n"+"    (______|______) \n")}if(window.sessionStorage){if(!window.sessionStorage.myDog){window.sessionStorage.myDog="Tom"}};